javascript:"use strict";{function e(e){let[t,n]=[16,19],a=!1;switch(!0){case e>=new Date(2025,1):[t,n]=[17,19];break;case e>=new Date(2024,9):[t,n]=[16,19];break;case e>=new Date(2024,3):[t,n]=[18,21]}if(!0==e>=new Date(2024,6))a=!0;return{peakTimeStart:t,peakTimeEnd:n,weekendsCountOffpeak:a}}const t=4;let n,a,o="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/",i=console.log,r=e=>("0"+e).slice(-2),l=e=>document.getElementById(e),c={},s=e=>y('[<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account</a>] <b>then click the bookmark again.</b>'),d=0;function f(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].consumption;return t}async function h(e=0){let t=m(e),n=0,a=0,l=t.firstDayOfMonth,s=t.year,d=r(t.month),h=0,u=[],p=!0;i("Month: ",t.mthName),y(`Month: ${t.mthName} ${t.year}, peak hours: ${t.peakTimeStart} to ${t.peakTimeEnd}`);let k=e=>{let n=0;for(let a=0;a<e.length;a++){let o=new Date(e[a].interval.start),i=o.getHours();0!=o.getTimezoneOffset()&&i++,i>=t.peakTimeStart&&i<t.peakTimeEnd&&(n+=e[a].consumption)}return n};for(let e=1;e<=t.lastDayOfMonth&&p;e++,l=++l%7){if(new Date(t.year,t.month-1,e)>=Date.now()){i("Ending calcs for the month.  Date is >= today",Date.now(),new Date(t.year,t.month-1,e));break}let m=`${s}-${d}-`+r(e),y=o+m,w=await fetch(y,{credentials:"include"});if(!0!==w.ok){i("bad response for",y);continue}g();let D=await w.json();if(p=D?.electricity?.next??!1,!D.electricity){i("No electricity data for "+m);continue}let b=D.electricity.data;if(b instanceof Array!=!1&&0!==b.length){if(48!=b.length&&i(m,"1/2 hourly data length not 48: ",b.length),c[m])i(m+" bank holiday "+c[m]),h++,u.push(c[m]);else if(0===l||6===l)t.weekendsCountOffpeak&&(a+=f(b),i("Weekend counts as offpeak: "+f(b)));else{let t=k(b),o=f(b);a+=o,n+=t,o>0&&i(`${r(e)} day ${(100*t/o).toFixed(3)}%  [${t.toFixed(3)}/${o.toFixed(3)}]`)}p||i("DATA ENDS for the month "+m)}else i("1/2 hourly data is empty or not an array",b)}let w=`TOTAL = ${a>0?(n/a*100).toFixed(2)+"%":"Not enough data yet..."}  [${n.toFixed(3)} / ${a.toFixed(3)}]kWh - bank holidays: ${h} `+u.join(", ");i(w),i(),y(w),y("&nbsp;")}function m(t=0){let n=new Date,a=new Date(n.getFullYear(),n.getMonth()-t,1),o=new Date(n.getFullYear(),n.getMonth()-t+1,0),{peakTimeStart:i,peakTimeEnd:r,weekendsCountOffpeak:l}=e(a);return{firstDayOfMonth:a.getDay(),lastDayOfMonth:o.getDate(),month:a.getMonth()+1,mthName:a.toLocaleString("default",{month:"long"}),year:a.getFullYear(),peakTimeStart:i,peakTimeEnd:r,weekendsCountOffpeak:l}}function u(){let e=Object.fromEntries(document.cookie.split("; ").map((e=>e.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==e){let t=JSON.parse(decodeURIComponent(e));if(a=t["Account Id"],a)return!0}return!1}function y(){for(let e of arguments){let t=document.createElement("div");t.innerHTML=e,msgs.append(t)}}function p(){document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',n=l("X")}function g(){d=!d,n.innerText=d?"◉":"◎"}(async()=>{if(0!=await void("account.ovoenergy.com"===window.location.host?c={"2024-12-25":"Christmas Day","2024-12-26":"Boxing Day","2025-01-01":"New Year's Day","2025-04-18":"Good Friday","2025-04-21":"Easter Monday","2025-05-05":"Early May bank holiday","2025-05-26":"Spring bank holiday","2025-08-25":"Summer bank holiday","2025-12-25":"Christmas Day","2025-12-26":"Boxing Day","2026-01-01":"New Year's Day"}:window.location.href="https://account.ovoenergy.com/usage?fuel=electricity"))if(p(),u()){y("Press F12 for more info"),i("Account id is fine"),o=o+a+"?date=";for(let e=0;e<t;e++)await h(e)}else s()})()}
