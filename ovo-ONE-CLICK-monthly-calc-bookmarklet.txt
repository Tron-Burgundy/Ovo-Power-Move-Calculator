javacript:"use strict";{const e=4;let t={};function n(){if("account.ovoenergy.com"!==window.location.host)return window.location.href="https://account.ovoenergy.com/usage?fuel=electricity",!1;t={"2024-12-25":"Christmas Day","2024-12-26":"Boxing Day","2025-01-01":"New Year's Day","2025-04-18":"Good Friday","2025-04-21":"Easter Monday","2025-05-05":"Early May bank holiday","2025-05-26":"Spring bank holiday","2025-08-25":"Summer bank holiday","2025-12-25":"Christmas Day","2025-12-26":"Boxing Day","2026-01-01":"New Year's Day"}}function a(e){let[t,n]=[16,19],a=!1;switch(!0){case e>=new Date(2025,1):[t,n]=[17,19];break;case e>=new Date(2024,9):[t,n]=[16,19];break;case e>=new Date(2024,3):[t,n]=[18,21]}if(!0==e>=new Date(2024,6))a=!0;return{peakTimeStart:t,peakTimeEnd:n,weekendsCountOffpeak:a}}let o,i,r="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/",l=console.log,c=e=>("0"+e).slice(-2),s=e=>document.getElementById(e),d=e=>p('[<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account</a>] <b>then click the bookmark again.</b>'),f=0;function m(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].consumption;return t}async function u(e=0){let n=h(e),a=0,o=0,i=n.firstDayOfMonth,s=n.year,d=c(n.month),f=0,u=[],y=!0;l("Month: ",n.mthName),p(`Month: ${n.mthName} ${n.year}, peak hours: ${n.peakTimeStart} to ${n.peakTimeEnd}`);let g=e=>{let t=0;for(let a=0;a<e.length;a++){let o=new Date(e[a].interval.start),i=o.getHours();0!=o.getTimezoneOffset()&&i++,i>=n.peakTimeStart&&i<n.peakTimeEnd&&(t+=e[a].consumption)}return t};for(let e=1;e<=n.lastDayOfMonth&&y;e++,i=++i%7){if(new Date(n.year,n.month-1,e)>=Date.now()){l("Ending calcs for the month.  Date is >= today",Date.now(),new Date(n.year,n.month-1,e));break}let h=`${s}-${d}-`+c(e),p=r+h,w=await fetch(p,{credentials:"include"});if(!0!==w.ok){l("bad response for",p);continue}k();let D=await w.json();if(y=D?.electricity?.next??!1,!D.electricity){l("No electricity data for "+h);continue}let b=D.electricity.data;if(b instanceof Array!=!1&&0!==b.length){if(48!=b.length&&l(h,"1/2 hourly data length not 48: ",b.length),t[h])l(h+" bank holiday "+t[h]),f++,u.push(t[h]);else if(0===i||6===i)n.weekendsCountOffpeak&&(o+=m(b),l("Weekend counts as offpeak: "+m(b)));else{let t=g(b),n=m(b);o+=n,a+=t,n>0&&l(`${c(e)} day ${(100*t/n).toFixed(3)}%  [${t.toFixed(3)}/${n.toFixed(3)}]`)}y||l("DATA ENDS for the month "+h)}else l("1/2 hourly data is empty or not an array",b)}let w=`TOTAL = ${o>0?(a/o*100).toFixed(2)+"%":"Not enough data yet..."}  [${a.toFixed(3)} / ${o.toFixed(3)}]kWh - bank holidays: ${f} `+u.join(", ");l(w),l(),p(w),p("&nbsp;")}function h(e=0){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-e,1),o=new Date(t.getFullYear(),t.getMonth()-e+1,0),{peakTimeStart:i,peakTimeEnd:r,weekendsCountOffpeak:l}=a(n);return{firstDayOfMonth:n.getDay(),lastDayOfMonth:o.getDate(),month:n.getMonth()+1,mthName:n.toLocaleString("default",{month:"long"}),year:n.getFullYear(),peakTimeStart:i,peakTimeEnd:r,weekendsCountOffpeak:l}}function y(){let e=Object.fromEntries(document.cookie.split("; ").map((e=>e.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==e){let t=JSON.parse(decodeURIComponent(e));if(i=t["Account Id"],i)return!0}return!1}function p(){for(let e of arguments){let t=document.createElement("div");t.innerHTML=e,msgs.append(t)}}function g(){document.body.innerHTML='<div style="padding: 1em">Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',o=s("X")}function k(){f=!f,o.innerText=f?"◉":"◎"}(async()=>{if(!1!==await n())if(g(),y()){p("Press F12 for more info"),l("Account id is fine"),r=r+i+"?date=";for(let t=0;t<e;t++)await u(t)}else d()})()}
