javascript:"use strict";{const e=4;let t={"2024-01-01":"New Year’s Day","2024-03-29":"Good Friday","2024-04-01":"Easter Monday","2024-05-06":"Early May bank holiday","2024-05-27":"Spring bank holiday","2024-08-26":"Summer bank holiday"},n="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/";const o="https://account.ovoenergy.com/usage?fuel=electricity";let a,i,r=console.log,l=e=>("0"+e).slice(-2),c=e=>document.getElementById(e),s=e=>y('[<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account</a>] <b>then click the bookmark again.</b>'),d=0;function f(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].consumption;return t}async function h(e=0){let o=u(e),a=0,i=0,c=o.firstDayOfMonth,s=o.year,d=l(o.month),h=0,m=[],p=!0;r("Month: ",o.mthName),y(`Month: ${o.mthName} ${o.year}, peak hours: ${o.peakTimeStart} to ${o.peakTimeEnd}`);let k=e=>{let t=0;for(let n=0;n<e.length;n++){let a=new Date(e[n].interval.start),i=a.getHours();0!=a.getTimezoneOffset()&&i++,i>=o.peakTimeStart&&i<o.peakTimeEnd&&(t+=e[n].consumption)}return t};for(let e=1;e<=o.lastDayOfMonth&&p;e++,c=++c%7){if(new Date(o.year,o.month-1,e)>=Date.now()){r("Ending calcs for the month.  Date is >= today",Date.now(),new Date(o.year,o.month-1,e));break}let u=`${s}-${d}-`+l(e),y=n+u,w=await fetch(y,{credentials:"include"});if(!0!==w.ok){r("bad response for",y);continue}g();let D=await w.json();if(p=D?.electricity?.next??!1,p||r("DATA ENDS for the month "+u),!D.electricity){r("No electricity data for "+u);continue}let b=D.electricity.data;if(b instanceof Array!=!1&&0!==b.length)if(48!=b.length&&r(u,"1/2 hourly data length not 48: ",b.length),t[u])r(u+" bank holiday "+t[u]),h++,m.push(t[u]);else if(0===c||6===c)o.weekendsCountOffpeak&&(i+=f(b),r("Weekend counts as offpeak: "+f(b)));else{let t=k(b),n=f(b);i+=n,a+=t,n>0&&r(`${l(e)} day ${(100*t/n).toFixed(3)}%  [${t.toFixed(3)}/${n.toFixed(3)}]`)}else r("1/2 hourly data is empty or not an array",b)}let w=`TOTAL = ${i>0?(a/i*100).toFixed(2)+"%":"Not enough data yet..."}  [${a.toFixed(3)} / ${i.toFixed(3)}]kWh - bank holidays: ${h} `+m.join(", ");r(w),r(),y(w),y("&nbsp;")}function u(e=0){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-e,1),o=new Date(t.getFullYear(),t.getMonth()-e+1,0),[a,i]=n>=new Date(2024,3)?[18,21]:[16,19],r=n>=new Date(2024,7);return{firstDayOfMonth:n.getDay(),lastDayOfMonth:o.getDate(),month:n.getMonth()+1,mthName:n.toLocaleString("default",{month:"long"}),year:n.getFullYear(),peakTimeStart:a,peakTimeEnd:i,weekendsCountOffpeak:r}}function m(){let e=Object.fromEntries(document.cookie.split("; ").map((e=>e.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==e){let t=JSON.parse(decodeURIComponent(e));if(i=t["Account Id"],i)return!0}return!1}function y(){for(let e of arguments){let t=document.createElement("div");t.innerHTML=e,msgs.append(t)}}function p(){document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',a=c("X")}function g(){d=!d,a.innerText=d?"◉":"◎"}(async()=>{if("account.ovoenergy.com"===window.location.host)if(p(),m()){y("Press F12 for more info"),r("Account id is fine"),n=n+i+"?date=";for(let t=0;t<e;t++)await h(t)}else s();else window.location.href=o})()}
