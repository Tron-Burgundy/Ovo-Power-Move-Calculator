javascript:"use strict";{const e=4;let t={"2023-08-28":"Summer bank holiday","2023-12-25":"Christmas Day","2023-12-26":"Boxing Day","2024-01-01":"New Year’s Day","2024-03-29":"Good Friday","2024-04-01":"Easter Monday","2024-05-06":"Early May bank holiday","2024-05-27":"Spring bank holiday","2024-08-26":"Summer bank holiday"},o="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/";const n="https://account.ovoenergy.com/usage?fuel=electricity";let a,i,r=console.log,l=e=>("0"+e).slice(-2),c=e=>document.getElementById(e),d=()=>u('[<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account</a>] <b>then click the bookmark again.</b>'),s=0;async function m(e=0){let n=h(e),a=0,i=0,c=n.fdom,d=n.year,s=l(n.month),m=0,f=[],y=!0;r("Month: ",n.mthName),u("Month: "+n.mthName+" "+n.year+", peak hours : "+n.peakTimeStart+" to "+n.peakTimeEnd);for(let e=1;e<=n.ldom&&y;e++,c=++c%7){if(new Date(n.year,n.month-1,e)>=Date.now()){console.log("Ending calcs for the month. Date is >= today",Date.now(),new Date(n.year,n.month-1,e));break}let h=`${d}-${s}-`+l(e),u=o+h,p=await fetch(u,{credentials:"include"});if(!0!==p.ok){r("bad response for",u);continue}g();let k=await p.json();if(y=k.electricity?.next??!1,y||console.log("DATA ENDS for the month "+h),c>0&&c<6){if(t[h]){r(h+" bank holiday "+t[h]),m++,f.push(t[h]);continue}if(k.electricity){let t=k.electricity.data;if(t instanceof Array==0){r("1/2 hourly data is not an array",t);continue}48!=t.length&&r(h,"1/2 hourly data length not 48: ",t.length);let o=0,c=0;for(let e=0;e<t.length;e++){c+=t[e].consumption;let a=new Date(t[e].interval.start),i=a.getHours();0!=a.getTimezoneOffset()&&i++,i>=n.peakTimeStart&&i<n.peakTimeEnd&&(o+=t[e].consumption)}if(i+=c,a+=o,r(`${l(e)} day ${(100*o/c).toFixed(3)}% [${o.toFixed(3)}/${c.toFixed(3)}]`),!0!==k.electricity.next)break}else r("Nooo for "+h)}}let p=`TOTAL = ${i>0?(a/i*100).toFixed(2)+"%":"Not enough data yet..."} [${a.toFixed(3)} / ${i.toFixed(3)}]kWh - bank holidays: ${m} `+f.join(", ");r(p),r(),u(p),u("&nbsp;")}function h(e=0){let t=new Date,o=new Date(t.getFullYear(),t.getMonth()-e,1),n=new Date(t.getFullYear(),t.getMonth()-e+1,0),[a,i]=o>=new Date(2024,3)?[18,21]:[16,19];return{fdom:o.getDay(),ldom:n.getDate(),month:o.getMonth()+1,mthName:o.toLocaleString("default",{month:"long"}),year:o.getFullYear(),peakTimeStart:a,peakTimeEnd:i}}function f(){let e=Object.fromEntries(document.cookie.split("; ").map((e=>e.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==e){let t=JSON.parse(decodeURIComponent(e));if(i=t["Account Id"],i)return!0}return!1}function u(){for(let e of arguments){let t=document.createElement("div");t.innerHTML=e,msgs.append(t)}}function y(){document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',a=c("X")}function g(){s=!s,a.innerText=s?"◉":"◎"}(async()=>{if("account.ovoenergy.com"===window.location.host)if(y(),f()){u("Press F12 for more info"),r("Account id is fine"),o=o+i+"?date=";for(let t=0;t<e;t++)await m(t)}else d();else window.location.href=n})()}
