javascript:let t=console.log,e=t=>("0"+t).slice(-2),o=t=>document.getElementById(t),a=[],n={},d=0,s="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/";async function l(o=0){let d=function(t=0){let e=new Date,o=new Date(e.getFullYear(),e.getMonth()-t,1),a=new Date(e.getFullYear(),e.getMonth()-t+1,0);return{fdom:o.getDay(),ldom:a.getDate(),month:o.getMonth()+1,mthName:o.toLocaleString("default",{month:"long"}),year:o.getFullYear()}}(o),l=0;total=0;let m=d.fdom,f=d.year,h=e(d.month),y=0,g=[],u=!0;for(t("Month: ",d.mthName),c("Month: "+d.mthName),i=1;i<=d.ldom&&u;i++,m=++m%7)if(m>0&&m<6){if(dts=`${f}-${h}-`+e(i),a.includes(dts)){t(dts+" bank holiday "+n[dts]),y++,g.push(n[dts]);continue}0;let o=s+dts;if(data=await fetch(o),!0!==data.ok){t("bad response for",o);continue}r();let d=await data.json();if(d.electricity){let o=d.electricity.data;if(u=d.electricity.next,o instanceof Array==0){t("1/2 hourly data is not an array",o);continue}48!=o.length&&t(dts,"1/2 hourly data length not 48: ",o.length),e427Tot=0,dayTot=0;for(let t=0;t<o.length;t++){dayTot+=o[t].consumption;let e=new Date(o[t].interval.start),a=e.getHours();0!=e.getTimezoneOffset()&&a++,a>=16&&a<19&&(e427Tot+=o[t].consumption)}if(total+=dayTot,l+=e427Tot,t(`${e(i)} day ${(100*e427Tot/dayTot).toFixed(3)}%  [${e427Tot.toFixed(3)}/${dayTot.toFixed(3)}]`),!0!==d.electricity.next)break}else t("Nooo for "+dts)}let p=`TOTAL ${(l/total*100).toFixed(2)}%  [${l.toFixed(3)} / ${total.toFixed(3)}] - bank holidays: ${y} `+g.join(", ");t(p),t(),c(p),c("&nbsp;")}function c(){for(let t of arguments)nd=document.createElement("div"),nd.innerHTML=t,msgs.append(nd)}function r(){d=!d,xDiv.innerText=d?"◉":"◎"}(async()=>{if(document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',mDiv=o("msgs"),xDiv=o("X"),function(){let t=Object.fromEntries(document.cookie.split("; ").map((t=>t.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==t&&(acct=JSON.parse(decodeURIComponent(t)),acctid=acct["Account Id"],acctid))return!0;return!1}())if("smartpaymapi.ovoenergy.com"==window.location.host){s=s+acctid+"?date=";try{let e=await fetch("https://www.gov.uk/bank-holidays.json");if(e.ok){let o=await e.json();for(let t of o["england-and-wales"].events)a.push(t.date),n[t.date]=t.title;t("got bank holidays")}}catch(t){c("Can't process bank holidays")}c("Press F12 for more info");for(let t=0;t<6;t++)await l(t)}else c('<b>ERROR:</b> <a href="https://smartpaymapi.ovoenergy.com/">CLICK HERE to go to the website</a> then ignore the onscreen message and use the bookmark again.');else c('<b>ERROR:</b> [<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account first.</a>]')})();