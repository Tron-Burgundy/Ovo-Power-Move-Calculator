javascript:let zone="england-and-wales",l=console.log,pad=t=>("0"+t).slice(-2),gid=t=>document.getElementById(t),bhdates=[],bhEvents={},spx=0,url="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/",errLgin=t=>o('<b>ERROR:</b> [<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account first.</a>]'),errLoc=t=>o('<b>ERROR:</b> <a href="https://smartpaymapi.ovoenergy.com/">CLICK HERE to go to the website</a> then ignore the onscreen message and use the bookmark again.');async function main(t=0){let e=firstday_lastday(t),a=0;total=0;let n=e.fdom,s=e.year,d=pad(e.month),r=0,c=[],m=!0;for(l("Month: ",e.mthName),o("Month: "+e.mthName),i=1;i<=e.ldom&&m;i++,n=++n%7)if(n>0&&n<6){if(dts=`${s}-${d}-`+pad(i),bhdates.includes(dts)){l(dts+" bank holiday "+bhEvents[dts]),r++,c.push(bhEvents[dts]);continue}0;let t=url+dts;if(data=await fetch(t),!0!==data.ok){l("bad response for",t);continue}spin();let e=await data.json();if(e.electricity){let t=e.electricity.data;if(m=e.electricity.next,t instanceof Array==0){l("1/2 hourly data is not an array",t);continue}48!=t.length&&l(dts,"1/2 hourly data length not 48: ",t.length),e427Tot=0,dayTot=0;for(let e=0;e<t.length;e++){dayTot+=t[e].consumption;let o=new Date(t[e].interval.start),a=o.getHours();0!=o.getTimezoneOffset()&&a++,a>=16&&a<19&&(e427Tot+=t[e].consumption)}if(total+=dayTot,a+=e427Tot,l(`${pad(i)} day ${(100*e427Tot/dayTot).toFixed(3)}%  [${e427Tot.toFixed(3)}/${dayTot.toFixed(3)}]`),!0!==e.electricity.next)break}else l("Nooo for "+dts)}let h=`TOTAL ${(a/total*100).toFixed(2)}%  [${a.toFixed(3)} / ${total.toFixed(3)}] - bank holidays: ${r} `+c.join(", ");l(h),l(),o(h),o("&nbsp;")}function firstday_lastday(t=0){let e=new Date,o=new Date(e.getFullYear(),e.getMonth()-t,1),a=new Date(e.getFullYear(),e.getMonth()-t+1,0);return{fdom:o.getDay(),ldom:a.getDate(),month:o.getMonth()+1,mthName:o.toLocaleString("default",{month:"long"}),year:o.getFullYear()}}function set_acct_num(){let t=Object.fromEntries(document.cookie.split("; ").map((t=>t.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;return!(void 0===t||(acct=JSON.parse(decodeURIComponent(t)),acctid=acct["Account Id"],!acctid))}function o(){for(let t of arguments)nd=document.createElement("div"),nd.innerHTML=t,msgs.append(nd)}function setup(){document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',mDiv=gid("msgs"),xDiv=gid("X")}function spin(){spx=!spx,xDiv.innerText=spx?"◉":"◎"}(async()=>{if(setup(),set_acct_num())if("smartpaymapi.ovoenergy.com"==window.location.host){url=url+acctid+"?date=";try{let t=await fetch("https://www.gov.uk/bank-holidays.json");if(t.ok){let e=await t.json();for(let t of e[zone].events)bhdates.push(t.date),bhEvents[t.date]=t.title;l("got bank holidays")}}catch(t){o("Can't process bank holidays")}o("Press F12 for more info");for(let t=0;t<6;t++)await main(t)}else errLoc();else errLgin()})();
