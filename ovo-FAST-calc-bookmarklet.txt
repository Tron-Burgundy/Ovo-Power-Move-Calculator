javascript:"use strict";{let t="england-and-wales";const e=4;let o="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/";const n="https://twitch-tools.glitch.me/ovo.html?months="+e,a="https://account.ovoenergy.com/usage?fuel=electricity",i="https://www.gov.uk/bank-holidays.json";let l,c,r=console.log,s=t=>("0"+t).slice(-2),d=t=>document.getElementById(t),h={},f=t=>p('<b>Part 1 of 3:</b> [<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account</a>] <b>then click the bookmark again.</b>'),m=0;async function u(){let o=new Date,n=new Date;n.setMonth(n.getMonth()-e-1),o.setMonth(o.getMonth()+1);try{let e=await fetch(i);if(e.ok){let a=await e.json();for(let e of a[t].events){let t=new Date(e.date);t>n&&t<o&&(h[e.date]=e.title)}return r("got bank holidays"),!0}}catch(t){}let a=new window.URLSearchParams(window.location.search).get("bh");if(null===a)return!1;try{h=JSON.parse(a)}catch(t){return!1}return!0}async function g(t=0){let e=y(t),n=0,a=0,i=e.fdom,l=e.year,c=s(e.month),d=0,f=[],m=!0;r("Month: ",e.mthName),p("Month: "+e.mthName+" "+e.year+",  peak hours : "+e.peakTimeStart+" to "+e.peakTimeEnd);for(let t=1;t<=e.ldom&&m;t++,i=++i%7){if(new Date(e.year,e.month-1,t)>=Date.now()){console.log("Ending calcs for the month.  Date is >= today",Date.now(),new Date(e.year,e.month-1,t));break}let u=`${l}-${c}-`+s(t),g=o+u,y=await fetch(g,{credentials:"include"});if(!0!==y.ok){r("bad response for",g);continue}b();let w=await y.json();if(m=void 0!==w.electricity&&null!==w.electicity&&void 0!==w.electricity.next&&w.electricity.next,m||console.log("DATA ENDS for the month "+u),i>0&&i<6){if(h[u]){r(u+" bank holiday "+h[u]),d++,f.push(h[u]);continue}if(w.electricity){let o=w.electricity.data;if(o instanceof Array==0){r("1/2 hourly data is not an array",o);continue}48!=o.length&&r(u,"1/2 hourly data length not 48: ",o.length);let i=0,l=0;for(let t=0;t<o.length;t++){l+=o[t].consumption;let n=new Date(o[t].interval.start),a=n.getHours();0!=n.getTimezoneOffset()&&a++,a>=e.peakTimeStart&&a<e.peakTimeEnd&&(i+=o[t].consumption)}if(a+=l,n+=i,r(`${s(t)} day ${(100*i/l).toFixed(3)}%  [${i.toFixed(3)}/${l.toFixed(3)}]`),!0!==w.electricity.next)break}else r("Nooo for "+u)}}let u=`TOTAL = ${a>0?(n/a*100).toFixed(2)+"%":"Not enough data yet..."}  [${n.toFixed(3)} / ${a.toFixed(3)}]kWh - bank holidays: ${d} `+f.join(", ");r(u),r(),p(u),p("&nbsp;")}function y(t=0){let e=new Date,o=new Date(e.getFullYear(),e.getMonth()-t,1),n=new Date(e.getFullYear(),e.getMonth()-t+1,0),[a,i]=o>=new Date(2024,3)?[18,21]:[16,19];return{fdom:o.getDay(),ldom:n.getDate(),month:o.getMonth()+1,mthName:o.toLocaleString("default",{month:"long"}),year:o.getFullYear(),peakTimeStart:a,peakTimeEnd:i}}function w(){let t=Object.fromEntries(document.cookie.split("; ").map((t=>t.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==t){let e=JSON.parse(decodeURIComponent(t));if(c=e["Account Id"],c)return!0}return!1}function p(){for(let t of arguments){let e=document.createElement("div");e.innerHTML=t,msgs.append(e)}}function k(){document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',l=d("X")}function b(){m=!m,l.innerText=m?"◉":"◎"}(async()=>{if("account.ovoenergy.com"===window.location.host)if(k(),"account.ovoenergy.com"!=window.location.host||w())if(p("Press F12 for more info"),r("Account id is fine"),o=o+c+"?date=",await u())for(let t=0;t<e;t++)await g(t);else window.location.href=n;else f();else{if(!await u())return void(window.location.href=a);let t=a+"&bh="+encodeURIComponent(JSON.stringify(h));window.location.href=t}})()}
