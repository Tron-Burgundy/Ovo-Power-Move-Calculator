javascript:"use strict";{let e="england-and-wales";const t=4;let n="https://smartpaymapi.ovoenergy.com/usage/api/half-hourly/";const o="https://twitch-tools.glitch.me/ovo.html?months="+t,a="https://account.ovoenergy.com/usage?fuel=electricity",i="https://www.gov.uk/bank-holidays.json";let r,l,c=console.log,s=e=>("0"+e).slice(-2),h=e=>document.getElementById(e),f={},d=e=>p('<b>Part 1 of 3:</b> [<a href="https://account.ovoenergy.com/">CLICK HERE to sign into your Ovo account</a>] <b>then click the bookmark again.</b>'),u=0;async function m(){let n=new Date,o=new Date;o.setMonth(o.getMonth()-t-1),n.setMonth(n.getMonth()+1);try{let t=await fetch(i);if(t.ok){let a=await t.json();for(let t of a[e].events){let e=new Date(t.date);e>o&&e<n&&(f[t.date]=t.title)}return c("got bank holidays"),!0}}catch(e){}let a=new window.URLSearchParams(window.location.search).get("bh");if(null===a)return!1;try{f=JSON.parse(a)}catch(e){return!1}return!0}async function y(e=0){let t=g(e),o=0,a=0,i=t.firstDayOfMonth,r=t.year,l=s(t.month),h=0,d=[],u=!0;c("Month: ",t.mthName),p(`Month: ${t.mthName} ${t.year}, peak hours: ${t.peakTimeStart} to ${t.peakTimeEnd}`);let m=e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n].consumption;return t},y=e=>{let n=0;for(let o=0;o<e.length;o++){let a=new Date(e[o].interval.start),i=a.getHours();0!=a.getTimezoneOffset()&&i++,i>=t.peakTimeStart&&i<t.peakTimeEnd&&(n+=e[o].consumption)}return n};for(let e=1;e<=t.lastDayOfMonth&&u;e++,i=++i%7){if(new Date(t.year,t.month-1,e)>=Date.now()){c("Ending calcs for the month.  Date is >= today",Date.now(),new Date(t.year,t.month-1,e));break}let g=`${r}-${l}-`+s(e),w=n+g,p=await fetch(w,{credentials:"include"});if(!0!==p.ok){c("bad response for",w);continue}D();let k=await p.json();if(u=k?.electricity?.next??!1,u||c("DATA ENDS for the month "+g),!k.electricity){c("No electricity data for "+g);continue}let b=k.electricity.data;if(b instanceof Array!=!1&&0!==b.length)if(48!=b.length&&c(g,"1/2 hourly data length not 48: ",b.length),f[g])c(g+" bank holiday "+f[g]),h++,d.push(f[g]);else if(0===i||6===i)t.weekendsCountOffpeak&&(a+=m(b),c("Weekend counts as offpeak: "+m(b)));else{let t=y(b),n=m(b);a+=n,o+=t,n>0&&c(`${s(e)} day ${(100*t/n).toFixed(3)}%  [${t.toFixed(3)}/${n.toFixed(3)}]`)}else c("1/2 hourly data is empty or not an array",b)}let w=`TOTAL = ${a>0?(o/a*100).toFixed(2)+"%":"Not enough data yet..."}  [${o.toFixed(3)} / ${a.toFixed(3)}]kWh - bank holidays: ${h} `+d.join(", ");c(w),c(),p(w),p("&nbsp;")}function g(e=0){let t=new Date,n=new Date(t.getFullYear(),t.getMonth()-e,1),o=new Date(t.getFullYear(),t.getMonth()-e+1,0),[a,i]=n>=new Date(2024,3)?[18,21]:[16,19],r=n>=new Date(2024,6);return{firstDayOfMonth:n.getDay(),lastDayOfMonth:o.getDate(),month:n.getMonth()+1,mthName:n.toLocaleString("default",{month:"long"}),year:n.getFullYear(),peakTimeStart:a,peakTimeEnd:i,weekendsCountOffpeak:r}}function w(){let e=Object.fromEntries(document.cookie.split("; ").map((e=>e.split("=")))).mp_457e7322cdf0dcb51030b6a3bafd8805_mixpanel;if(void 0!==e){let t=JSON.parse(decodeURIComponent(e));if(l=t["Account Id"],l)return!0}return!1}function p(){for(let e of arguments){let t=document.createElement("div");t.innerHTML=e,msgs.append(t)}}function k(){document.body.innerHTML='<div>Working: [<span id="X">+</span>]<p><div id="msgs"></div></div>',r=h("X")}function D(){u=!u,r.innerText=u?"◉":"◎"}(async()=>{if("account.ovoenergy.com"===window.location.host)if(k(),"account.ovoenergy.com"!=window.location.host||w())if(p("Press F12 for more info"),c("Account id is fine"),n=n+l+"?date=",await m())for(let e=0;e<t;e++)await y(e);else window.location.href=o;else d();else{if(!await m())return void(window.location.href=a);let e=a+"&bh="+encodeURIComponent(JSON.stringify(f));window.location.href=e}})()}
